#!/usr/bin/perl
use strict;

my @p;
my @l;
while (<>) {
    chomp;

    if (/^\d:/) {

        my %p;
        for my $y (0,1,2) {
            $_ = <>;
            chomp;
            tr/#./10/;
            my $x = 0;
            $p{$x++ .",$y"} = $_ for split '';
        }

        my %v;
        for my $c (
            [
                '0,0', '1,0', '2,0',
                '0,1', '1,1', '2,1',
                '0,2', '1,2', '2,2',
            ],
            [
                '2,0', '1,0', '0,0',
                '2,1', '1,1', '0,1',
                '2,2', '1,2', '0,2',
            ],
            [
                '0,2', '1,2', '2,2',
                '0,1', '1,1', '2,1',
                '0,0', '1,0', '2,0',
            ],
            [
                '2,2', '1,2', '0,2',
                '2,1', '1,1', '0,1',
                '2,0', '1,0', '0,0',
            ],

            [
                '0,0', '0,1', '0,2',
                '1,0', '1,1', '1,2',
                '2,0', '2,1', '2,2',
            ],
            [
                '0,2', '0,1', '0,0',
                '1,2', '1,1', '1,0',
                '2,2', '2,1', '2,0',
            ],
            [
                '2,0', '2,1', '2,2',
                '1,0', '1,1', '1,2',
                '0,0', '0,1', '0,2',
            ],
            [
                '2,2', '2,1', '2,0',
                '1,2', '1,1', '1,0',
                '0,2', '0,1', '0,0',
            ],
        ) {
            my $r1 = eval "0b$p{$c->[0]}$p{$c->[1]}$p{$c->[2]}";
            my $r2 = eval "0b$p{$c->[3]}$p{$c->[4]}$p{$c->[5]}";
            my $r3 = eval "0b$p{$c->[6]}$p{$c->[7]}$p{$c->[8]}";
            $v{"$r1, $r2, $r3"} = [$r1, $r2, $r3];
        }

        push @p => [values %v];

    } elsif (/(\d+)x(\d+): (.+)/) {
        push @l => [$1, $2, split ' ', $3];
    }
}


my @r = (
    '...',
    '..#',
    '.#.',
    '.##',
    '#..',
    '#.#',
    '##.',
    '###',
);

my $i = 0;
for my $pi (0..$#p) {
    print "$pi:\n";
    for my $v (@{$p[$pi]}) {
        $i++;
        for my $r (@$v) {
            print "$r[$r]\n";
        }
        print "\n";
    }
    print "\n";
}

print "Unique shapes: $i\n";


for (@l) {
    my ($w, $h, @q) = @$_;

    print "w: $w, h: $h, q: @q\n";
}
